<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="/admin/fragments/head :: head" xmlns:th="http://www.thymeleaf.org">
</head>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous">

<style>
        /* Tổng thể form */
    .registration-container {
        max-width: 600px;
        margin: 0 auto;
        padding: 30px;
        background-color: #ffffff;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .registration-title {
        font-size: 28px;
        font-weight: bold;
        text-align: center;
        margin-bottom: 20px;
        color: #333;
    }

    /* Các nhãn */
    .form-label {
        font-size: 14px;
        font-weight: bold;
        color: #444;
    }

    /* Input và Select */
    .form-control {
        border-radius: 5px;
        border: 1px solid #ced4da;
        transition: border-color 0.3s, box-shadow 0.3s;
    }

    .form-control:focus {
        border-color: #007bff;
        box-shadow: 0 0 6px rgba(0, 123, 255, 0.3);
    }

    /* Nút Đăng Ký */
    .btn {
        border-radius: 50px;
        background-color: #007bff;
        color: #fff;
        font-size: 16px;
        padding: 10px 20px;
        transition: background-color 0.3s, transform 0.2s;
    }

    .btn:hover {
        background-color: #0056b3;
        transform: scale(1.02);
    }

    /* Validation thông báo lỗi */
    .text-danger {
        font-size: 12px;
        margin-top: 5px;
        display: block;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .registration-container {
            padding: 20px;
        }

        .registration-title {
            font-size: 24px;
        }
    }


</style>
<body>

<div class="registration-container mt-5">
    <div class="registration-title">Đăng Ký Tài Khoản</div>
    <form th:action="@{/register}" method="post" id="registrationForm">
        <div class="mb-3">
            <label for="email" class="form-label">Email</label>
            <input type="email" class="form-control" id="email" name="email" placeholder="Nhập email">
            <div class="text-danger" th:if="${error}" th:text="${error}"></div>
        </div>
        <div class="mb-3">
            <label for="matKhau" class="form-label">Mật khẩu</label>
            <input type="password" class="form-control" id="matKhau" name="matKhau" placeholder="Nhập mật khẩu">
        </div>
        <div class="mb-3">
            <label for="xacNhanMatKhau" class="form-label">Xác nhận mật khẩu</label>
            <input type="password" class="form-control" id="xacNhanMatKhau" name="xacNhanMatKhau"
                   placeholder="Nhập lại mật khẩu">
        </div>
        <button type="submit" class="btn w-100">Đăng Ký</button>
    </form>
</div>

</body>
</html>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    const cities = document.getElementById("city");
    const districts = document.getElementById("district");
    const wards = document.getElementById("ward");


    axios.get("https://raw.githubusercontent.com/kenzouno1/DiaGioiHanhChinhVN/master/data.json")
        .then(response => {
            const data = response.data;
            data.forEach(city => {
                cities.options[cities.options.length] = new Option(city.Name, city.Id);
            });
            cities.onchange = () => {
                districts.length = 1;
                wards.length = 1;
                const city = data.find(c => c.Id === cities.value);
                if (city) {
                    city.Districts.forEach(district => {
                        districts.options[districts.options.length] = new Option(district.Name, district.Id);
                    });
                }
            };
            districts.onchange = () => {
                wards.length = 1;
                const city = data.find(c => c.Id === cities.value);
                if (city) {
                    const district = city.Districts.find(d => d.Id === districts.value);
                    if (district) {
                        district.Wards.forEach(ward => {
                            wards.options[wards.options.length] = new Option(ward.Name, ward.Id);
                        });
                    }
                }
            };
        });

    document.getElementById("registrationForm").addEventListener("submit", function (event) {
        event.preventDefault(); // Ngăn chặn gửi biểu mẫu mặc định
        const email = document.getElementById("email").value.trim();
        const matKhau = document.getElementById("matKhau").value.trim();
        const xacNhanMatKhau = document.getElementById("xacNhanMatKhau").value.trim();

        // Kiểm tra trường "Email"
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!email) {
            showToast("Email không được để trống!", "error");
            return;
        }
        if (!emailRegex.test(email)) {
            showToast("Email không hợp lệ!", "error");
            return;
        }
        // Kiểm tra trường "Mật khẩu"
        const noSpecialCharRegex = /^[a-zA-Z0-9]+$/;
        if (!matKhau) {
            showToast("Mật khẩu không được để trống!", "error");
            return;
        }
        if (!noSpecialCharRegex.test(matKhau)) {
            showToast("Mật khẩu không được chứa ký tự đặc biệt!", "error");
            return;
        }
        if (!xacNhanMatKhau) {
            showToast("Xác nhận mật khẩu không được để trống!", "error");
            return;
        }
        if (matKhau !== xacNhanMatKhau) {
            showToast("Mật khẩu và xác nhận mật khẩu không khớp!", "error");
            return;
        }
        // Thông báo tải dữ liệu
        Swal.fire({
            toast: true,
            position: 'top-end',
            icon: 'success',
            title: 'Đang xử lý dữ liệu...',
            showConfirmButton: false,
            timer: 1500,
            timerProgressBar: true,
            didOpen: () => {
                Swal.showLoading();
            }
        });

        setTimeout(() => {
            // Gửi biểu mẫu khi hợp lệ
            event.target.submit();
        }, 1500);
    });

    // Hàm hiển thị thông báo nhỏ ở góc phải
    function showToast(message, iconType) {
        Swal.fire({
            toast: true,
            position: 'top-end',
            icon: iconType,
            title: message,
            showConfirmButton: false,
            timer: 3000,
            timerProgressBar: true
        });
    }
    document.getElementById("xacNhanMatKhau").addEventListener("input", function () {
        const matKhau = document.getElementById("matKhau").value.trim();
        const xacNhanMatKhau = this.value.trim();
        if (xacNhanMatKhau && matKhau !== xacNhanMatKhau) {
            this.setCustomValidity("Mật khẩu không khớp.");
        } else {
            this.setCustomValidity("");
        }
    });

</script>
